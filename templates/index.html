<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Python Auto-Repair</title>
<style>
body { background:#111; color:#eee; font-family: monospace; padding:20px; }
textarea { width:100%; height:200px; background:#222; color:#eee; border:none; padding:10px; }
button { margin:5px; padding:10px 15px; cursor:pointer; }
pre { background:#222; padding:10px; }
</style>
</head>
<body>
<h2>Python Auto-Repair Engine</h2>

<textarea id="code" placeholder="Pega tu c√≥digo aqu√≠..."></textarea>
<br>
<button onclick="analizar()">üîç Analizar & Reparar</button>
<button onclick="descargar()">‚¨á Descargar</button>

<h3>Reporte:</h3>
<pre id="report">Aqu√≠ aparecer√° el reporte...</pre>

<h3>C√≥digo corregido:</h3>
<pre id="fixed_code">Aqu√≠ aparecer√° el c√≥digo corregido...</pre>

<script>
async function analizar(){
    const code = document.getElementById("code").value;
    const res = await fetch("/analyze", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({code})
    });
    const data = await res.json();
    document.getElementById("report").textContent = JSON.stringify(data.report, null, 2);
    document.getElementById("fixed_code").textContent = data.fixed_code;
}

async function descargar(){
    const code = document.getElementById("fixed_code").textContent;
    const res = await fetch("/download", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({code})
    });
    const blob = await res.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "codigo_reparado.py";
    a.click();
    window.URL.revokeObjectURL(url);
}
</script>
</body>
</html>
