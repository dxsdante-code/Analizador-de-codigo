<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analizador de Código Python</title>
<style>
body { font-family: Arial, sans-serif; margin:20px; }
textarea { width:100%; height:200px; margin-bottom:10px; font-family: monospace; }
button { margin:5px; padding:8px 12px; }
#report, #semantic, #fixed_code { border:1px solid #ccc; padding:10px; margin-top:10px; white-space:pre-wrap; background:#f9f9f9; }
#optionsAB button { margin-right:5px; }
</style>
</head>
<body>
<h2>Analizador de Código Python</h2>

<textarea id="inputCode" placeholder="Pega tu código aquí..."></textarea><br>

<button id="analyzeBtn">Analizar</button>
<button id="copyBtn">Copiar Código Corregido</button>
<button id="downloadBtn">Descargar Código</button>

<div id="report"><strong>Reporte:</strong>\n</div>
<div id="fixed_code"><strong>Código Corregido:</strong>\n</div>
<div id="semantic"><strong>Análisis Semántico (IA):</strong>\n</div>

<div id="optionsAB"><strong>Aplicar alternativa IA:</strong><br></div>

<script>
const inputCode = document.getElementById("inputCode");
const reportDiv = document.getElementById("report");
const fixedDiv = document.getElementById("fixed_code");
const semanticDiv = document.getElementById("semantic");
const optionsDiv = document.getElementById("optionsAB");
const analyzeBtn = document.getElementById("analyzeBtn");
const copyBtn = document.getElementById("copyBtn");
const downloadBtn = document.getElementById("downloadBtn");

analyzeBtn.onclick = async () => {
    reportDiv.textContent = "Analizando...";
    fixedDiv.textContent = "";
    semanticDiv.textContent = "";
    optionsDiv.innerHTML = "<strong>Aplicar alternativa IA:</strong><br>";

    const resp = await fetch("/analyze",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({code:inputCode.value})
    });
    const data = await resp.json();

    reportDiv.textContent = "Reporte:\n"+JSON.stringify(data.report,null,2);
    fixedDiv.textContent = "Código Corregido:\n"+data.fixed_code;
    semanticDiv.textContent = "Análisis IA:\n"+JSON.stringify(data.ia,null,2);

    // Botones A/B
    if(data.ia && data.ia.problemas){
        data.ia.problemas.forEach(p=>{
            p.alternativas.forEach(a=>{
                const btn = document.createElement("button");
                btn.textContent = a.id;
                btn.onclick = ()=>{ inputCode.value = a.codigo; };
                optionsDiv.appendChild(btn);
            });
        });
    }
};

copyBtn.onclick = () => {
    navigator.clipboard.writeText(inputCode.value);
    alert("Código copiado al portapapeles");
};

downloadBtn.onclick = () => {
    const blob = new Blob([inputCode.value], {type:"text/x-python"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "codigo_reparado.py";
    a.click();
    URL.revokeObjectURL(url);
};
</script>
</body>
</html>
