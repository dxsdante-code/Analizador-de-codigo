<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Analizador de Código Python</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  margin: 0;
  padding: 20px;
}
textarea {
  width: 100%;
  min-height: 160px;
  background: #020617;
  color: #e5e7eb;
  border: 1px solid #334155;
  padding: 10px;
  margin-bottom: 10px;
  font-family: monospace;
}
button {
  background: #2563eb;
  color: white;
  border: none;
  padding: 8px 12px;
  margin: 4px;
  cursor: pointer;
}
button.alt {
  background: #16a34a;
}
button.warn {
  background: #dc2626;
}
.section {
  border: 1px solid #334155;
  padding: 10px;
  margin-top: 15px;
}
pre {
  background: #020617;
  padding: 10px;
  overflow-x: auto;
}
</style>
</head>

<body>

<h2>Analizador de Código Python</h2>

<textarea id="inputCode" placeholder="Pega aquí tu código Python..."></textarea>
<button onclick="analizar()">Analizar</button>

<div class="section">
<h3>Reporte</h3>
<ul id="reporte"></ul>
</div>

<div class="section">
<h3>Código corregido</h3>
<button onclick="copiar()">Copiar</button>
<pre id="codigo"></pre>
</div>

<div class="section">
<h3>Análisis semántico (IA)</h3>
<div id="ia"></div>
</div>

<script>
let codigoActual = "";

function analizar() {
  fetch("/analyze", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ code: document.getElementById("inputCode").value })
  })
  .then(r => r.json())
  .then(data => {
    codigoActual = data.code || "";
    document.getElementById("codigo").textContent = codigoActual;

    const rep = document.getElementById("reporte");
    rep.innerHTML = "";
    (data.lint || []).forEach(e => {
      const li = document.createElement("li");
      li.textContent = e;
      rep.appendChild(li);
    });

    renderIA(data.ia);
  });
}

function renderIA(ia) {
  const div = document.getElementById("ia");
  div.innerHTML = "";
  if (!ia || ia.error) {
    div.textContent = "Sin análisis IA";
    return;
  }

  const h = document.createElement("p");
  h.textContent = "Intención: " + ia.intencion;
  div.appendChild(h);

  ia.problemas.forEach((p, i) => {
    const box = document.createElement("div");
    box.className = "section";

    box.innerHTML = `
      <b>Línea ${p.linea}</b><br>
      ${p.descripcion}<br><br>
      <button class="alt" onclick="aplicar('${escape(p.alternativas[0].codigo)}')">
        Aplicar A
      </button>
      <button class="warn" onclick="aplicar('${escape(p.alternativas[1].codigo)}')">
        Aplicar B
      </button>
      <pre>A:\n${p.alternativas[0].codigo}\n\nB:\n${p.alternativas[1].codigo}</pre>
    `;
    div.appendChild(box);
  });
}

function aplicar(codigo) {
  codigoActual = unescape(codigo);
  document.getElementById("codigo").textContent = codigoActual;
}

function copiar() {
  navigator.clipboard.writeText(codigoActual);
  alert("Código copiado");
}
</script>

</body>
</html>
