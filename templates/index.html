<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Python AutoFix AI</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-900 text-slate-200 p-6">

<h1 class="text-2xl font-bold mb-4">ðŸ§  Python Auto-Repair</h1>

<textarea id="code" class="w-full h-72 p-4 bg-slate-800 font-mono text-sm rounded"
placeholder="# Pega tu cÃ³digo aquÃ­"></textarea>

<div class="flex gap-4 mt-4">
  <button onclick="analizar()" class="bg-indigo-600 px-6 py-2 rounded">Analizar</button>
  <button onclick="descargar()" class="bg-emerald-600 px-6 py-2 rounded">Descargar</button>
</div>

<h2 class="mt-6 font-bold">ðŸ“‹ Reporte</h2>
<pre id="reporte" class="bg-slate-800 p-4 rounded text-xs"></pre>

<script>
let codigoFinal = "";

async function analizar() {
  const code = document.getElementById("code").value;
  const res = await fetch("/analizar", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ code })
  });
  const data = await res.json();
  codigoFinal = data.codigo_corregido;
  document.getElementById("reporte").textContent =
    JSON.stringify(data.hallazgos, null, 2);
  document.getElementById("code").value = codigoFinal;
}

function descargar() {
  const form = document.createElement("form");
  form.method = "POST";
  form.action = "/descargar";
  const input = document.createElement("input");
  input.type = "hidden";
  input.name = "code";
  input.value = codigoFinal;
  form.appendChild(input);
  document.body.appendChild(form);
  form.submit();
}
</script>

</body>
</html>
